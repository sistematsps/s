<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Master</title>
<style>
body { font-family: Arial,sans-serif; background:#f5f5f5; padding:20px; }
h1,h2,h3 { color:red; }
button { padding:8px 12px; margin:3px; border:none; border-radius:5px; cursor:pointer; background:red; color:white; }
button:hover { background:blue; }
section { margin-top:20px; padding:15px; border:1px solid #ccc; background:#fff; border-radius:6px; display:none; }
table { width:100%; border-collapse: collapse; margin-top:10px; }
th,td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#eee; }
.vendor-btn { background:yellow; color:#333; padding:10px; margin:5px; cursor:pointer; border-radius:6px; display:block; width:100%; text-align:left; }
.vendor-btn:hover { background:#f3f3f3; }
</style>
</head>
<body>

<h1>Painel Master</h1>

<div id="botoesTopo">
  <button onclick="abrirSecao('caixa')">Caixa</button>
  <button onclick="abrirSecao('receitas')">Receitas</button>
  <button onclick="abrirSecao('gerenciar')">Gerenciar</button>
  <button onclick="abrirSecao('despesas')">Despesas</button>
  <button onclick="abrirSecao('lancamentos')">Lançamentos</button>
  <button onclick="abrirSecao('vendas')">Vendas</button>
  <button onclick="abrirSecao('cadastro')">Cadastro</button>
</div>

<!-- CAIXA -->
<section id="caixa">
  <h2>Caixa Master</h2>
  <table>
    <tr><td>Saldo Anterior</td><td id="saldoAnterior">0.00</td></tr>
    <tr><td>Apurado Total</td><td id="apuradoTotal">0.00</td></tr>
    <tr><td>Despesas</td><td id="despesasTotal">0.00</td></tr>
    <tr><td>Saldo Final</td><td id="saldoFinal">0.00</td></tr>
  </table>
  <h3>Partilha</h3>
  <table>
    <tr><td>Gerente 1 (25%)</td><td id="partilhaGer1">0.00</td></tr>
    <tr><td>Gerente 2 (25%)</td><td id="partilhaGer2">0.00</td></tr>
    <tr><td>Banca (50%)</td><td id="partilhaBanca">0.00</td></tr>
  </table>
</section>

<!-- RECEITAS -->
<section id="receitas">
  <h2>Adicionar Receita</h2>
  <label>Valor: <input type="number" id="valorReceita"/></label>
  <label>Descrição: <input type="text" id="descReceita"/></label>
  <label>Data: <input type="date" id="dataReceita"/></label>
  <button onclick="salvarReceita()">Salvar Receita</button>
</section>

<!-- GERENCIAR -->
<section id="gerenciar">
  <h2>Gerenciar Gerentes e Vendedores</h2>
  <div id="listaGerentes"></div>
</section>

<!-- DESPESAS -->
<section id="despesas">
  <h2>Adicionar Despesa</h2>
  <label>Data: <input type="date" id="dataDespesa"/></label>
  <label>Valor: <input type="number" id="valorDespesa"/></label>
  <label>Descrição: <input type="text" id="descDespesa"/></label>
  <button onclick="salvarDespesa()">Salvar Despesa</button>
</section>

<!-- LANÇAMENTOS -->
<section id="lancamentos">
  <h2>Lançamentos</h2>
  <div id="listaLancamentos"></div>
</section>

<!-- VENDAS -->
<section id="vendas">
  <h2>Vendas</h2>
  <div id="listaVendedores"></div>
  <div id="painelVendas" style="display:none;">
    <h3 id="tituloVendedorSelecionado"></h3>
    <button onclick="voltarListaVendedores()">Voltar</button>
    <button onclick="adicionarLinhaVenda()">Adicionar Linha</button>
    <table id="tabelaVendas">
      <thead>
        <tr><th>Data</th><th>Recebeu</th><th>Devolveu</th><th>Vendeu</th><th>Apurado</th><th>Pagou</th><th>Deve</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div style="margin-top:10px;">
      <span>Total Apurado: R$ <span id="totalApurado">0.00</span></span>
      <span>Total Pagou: R$ <span id="totalPagou">0.00</span></span>
      <span>Total Deve: R$ <span id="totalDeve">0.00</span></span>
      <button onclick="salvarVendas()">Salvar Vendas</button>
    </div>
  </div>
</section>

<!-- CADASTRO -->
<section id="cadastro">
  <h2>Cadastro</h2>
  <button onclick="window.location.href='cadastro.html'">Ir para Cadastro</button>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

// Config Firebase integrado
const firebaseConfig = {
  apiKey: "AIzaSyAdwrOqN4-VQsiBByk4FVG-cDvfrR8ZYac",
  authDomain: "dasorte-66ec5.firebaseapp.com",
  projectId: "dasorte-66ec5",
  storageBucket: "dasorte-66ec5.firebasestorage.app",
  messagingSenderId: "606389335961",
  appId: "1:606389335961:web:4986562c4ab1b133684508"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// Funções UI
function abrirSecao(id){
  document.querySelectorAll('section').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
}

// ==== Receitas ====
async function salvarReceita(){
  const valor = parseFloat(document.getElementById('valorReceita').value);
  const desc = document.getElementById('descReceita').value;
  const data = document.getElementById('dataReceita').value;
  if(isNaN(valor) || !data){ alert('Preencha corretamente'); return; }
  await addDoc(collection(db,'receitas'),{valor,desc,data});
  alert('Receita salva');
  calcularCaixa();
}

// ==== Despesas ====
async function salvarDespesa(){
  const valor = parseFloat(document.getElementById('valorDespesa').value);
  const desc = document.getElementById('descDespesa').value;
  const data = document.getElementById('dataDespesa').value;
  if(isNaN(valor) || !data){ alert('Preencha corretamente'); return; }
  await addDoc(collection(db,'despesas'),{valor,desc,data});
  alert('Despesa salva');
  calcularCaixa();
}

// ==== Caixa ====
async function calcularCaixa(){
  const snapR = await getDocs(collection(db,'receitas'));
  let saldoAnterior=0; snapR.forEach(d=> saldoAnterior+=parseFloat(d.data().valor||0));
  document.getElementById('saldoAnterior').textContent = saldoAnterior.toFixed(2);

  const snapD = await getDocs(collection(db,'despesas'));
  let totalDespesas=0; snapD.forEach(d=> totalDespesas+=parseFloat(d.data().valor||0));
  document.getElementById('despesasTotal').textContent = totalDespesas.toFixed(2);

  let apuradoTotal = saldoAnterior*0.5; // Exemplo
  document.getElementById('apuradoTotal').textContent = apuradoTotal.toFixed(2);

  let saldoFinal = saldoAnterior + apuradoTotal - totalDespesas;
  document.getElementById('saldoFinal').textContent = saldoFinal.toFixed(2);

  document.getElementById('partilhaGer1').textContent = (saldoFinal*0.25).toFixed(2);
  document.getElementById('partilhaGer2').textContent = (saldoFinal*0.25).toFixed(2);
  document.getElementById('partilhaBanca').textContent = (saldoFinal*0.5).toFixed(2);
}

// Inicial
calcularCaixa();
</script>

</body>
</html>
