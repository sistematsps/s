<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Pitimbu da Sorte</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      color: red;
      text-align: center;
    }
    input, select, button {
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: red;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background: blue;
    }
    .alt {
      text-align: center;
      margin-top: 10px;
    }
    .alt button {
      background: none;
      border: none;
      color: blue;
      cursor: pointer;
      font-size: 14px;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Login - Pitimbu da Sorte</h2>

    <!-- LOGIN -->
    <div id="loginDiv">
      <input id="emailLogin" type="email" placeholder="E-mail">
      <input id="senhaLogin" type="password" placeholder="Senha">
      <button onclick="login()">Entrar</button>
      <div class="alt">
        <button onclick="mostrarCadastro()">Criar nova conta</button>
      </div>
    </div>

    <!-- CADASTRO -->
    <div id="cadastroDiv" style="display:none;">
      <input id="nomeCadastro" placeholder="Nome completo">
      <input id="emailCadastro" type="email" placeholder="E-mail">
      <input id="senhaCadastro" type="password" placeholder="Senha">
      <select id="funcaoCadastro">
        <option value="">Selecione a função</option>
        <option value="MASTER">MASTER</option>
        <option value="GERENTE">GERENTE</option>
        <option value="VENDEDOR">VENDEDOR</option>
      </select>
      <input id="cotacaoCadastro" placeholder="Cotação (para vendedor)" type="number" step="0.01">
      <input id="gerenteCadastro" placeholder="Gerente responsável (se for vendedor)">
      <button onclick="criarConta()">Criar conta</button>
      <div class="alt">
        <button onclick="mostrarLogin()">Já tenho conta</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import { getFirestore, setDoc, doc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD8IxOX_0e6T7DUzGf1DlPOHLNCq5zCK2M",
      authDomain: "pitimbu-da-sorte-80aa6.firebaseapp.com",
      projectId: "pitimbu-da-sorte-80aa6",
      storageBucket: "pitimbu-da-sorte-80aa6.appspot.com",
      messagingSenderId: "365898285373",
      appId: "1:365898285373:web:2ce4e344f1e9774c068554"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Alternar telas
    window.mostrarCadastro = function() {
      document.getElementById('loginDiv').style.display = 'none';
      document.getElementById('cadastroDiv').style.display = 'block';
    }
    window.mostrarLogin = function() {
      document.getElementById('cadastroDiv').style.display = 'none';
      document.getElementById('loginDiv').style.display = 'block';
    }

    // Criar conta
    window.criarConta = async function() {
      const nome = document.getElementById('nomeCadastro').value.trim();
      const email = document.getElementById('emailCadastro').value.trim();
      const senha = document.getElementById('senhaCadastro').value.trim();
      const funcao = document.getElementById('funcaoCadastro').value;
      const cotacao = parseFloat(document.getElementById('cotacaoCadastro').value) || 0;
      const gerente = document.getElementById('gerenteCadastro').value.trim();

      if (!email || !senha || !nome || !funcao) return alert('Preencha todos os campos obrigatórios.');

      try {
        const userCred = await createUserWithEmailAndPassword(auth, email, senha);
        const uid = userCred.user.uid;
        await setDoc(doc(db, "usuarios", uid), {
          nome, email, funcao, cotacao, gerenteResponsavel: gerente
        });
        alert("Conta criada com sucesso!");
        window.location.href = "index.html";
      } catch (e) {
        console.error("Erro ao criar conta:", e);
        alert("Erro ao criar conta: " + e.message);
      }
    }

    // Login
    window.login = async function() {
      const email = document.getElementById('emailLogin').value.trim();
      const senha = document.getElementById('senhaLogin').value.trim();
      try {
        await signInWithEmailAndPassword(auth, email, senha);
        window.location.href = "index.html";
      } catch (e) {
        console.error("Erro ao entrar:", e);
        alert("Erro ao entrar: " + e.message);
      }
    }
  </script>
</body>
  </html>
