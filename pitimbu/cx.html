<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Caixa - Pitimbu da Sorte</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    padding: 20px;
  }
  h1 {
    text-align: center;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background: white;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
  }
  th {
    background: #007bff;
    color: white;
  }
  tr:nth-child(even) {
    background: #f9f9f9;
  }
  .totais {
    background: #e6ffe6;
    font-weight: bold;
  }
</style>
</head>
<body>
<h1>Caixa - Pitimbu da Sorte</h1>

<table id="tabelaCaixa">
  <thead>
    <tr>
      <th>Vendedor</th>
      <th>Apurou</th>
      <th>Devolveu</th>
      <th>Recebeu</th>
      <th>Deve</th>
    </tr>
  </thead>
  <tbody id="corpoTabela"></tbody>
  <tfoot>
    <tr class="totais">
      <td>Total</td>
      <td id="totalApurou">0</td>
      <td id="totalDevolveu">0</td>
      <td id="totalRecebeu">0</td>
      <td id="totalDeve">0</td>
    </tr>
    <tr class="totais">
      <td>Despesas Totais</td>
      <td colspan="4" id="totalDespesas">0</td>
    </tr>
    <tr class="totais">
      <td>Saldo Final</td>
      <td colspan="4" id="saldoFinal">0</td>
    </tr>
  </tfoot>
</table>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "SUA_API_KEY",
    authDomain: "SEU_DOMINIO.firebaseapp.com",
    projectId: "SEU_PROJECT_ID",
    storageBucket: "SEU_PROJECT_ID.appspot.com",
    messagingSenderId: "SEU_ID",
    appId: "SEU_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function carregarCaixa() {
    const dataAtual = new Date().toISOString().split('T')[0]; // Ex: 2025-10-27
    const docRef = doc(db, "cotacoes", dataAtual);
    const docSnap = await getDoc(docRef);

    if (!docSnap.exists()) {
      alert("Nenhum registro encontrado para " + dataAtual);
      return;
    }

    const dados = docSnap.data();
    const vendedores = dados.vendedores || {};
    const despesas = dados.despesas || {};

    const corpoTabela = document.getElementById("corpoTabela");
    corpoTabela.innerHTML = "";

    let totalApurou = 0, totalDevolveu = 0, totalRecebeu = 0, totalDeve = 0, totalDespesas = 0;

    // ðŸ”¹ Carrega as vendas
    for (const nome in vendedores) {
      const vendedor = vendedores[nome];
      const vendas = vendedor.vendas || {};

      for (const dataVenda in vendas) {
        const v = vendas[dataVenda];
        corpoTabela.innerHTML += `
          <tr>
            <td>${vendedor.nome}</td>
            <td>${v.apurou?.toFixed(2) || 0}</td>
            <td>${v.devolveu?.toFixed(2) || 0}</td>
            <td>${v.recebeu?.toFixed(2) || 0}</td>
            <td>${v.deve?.toFixed(2) || 0}</td>
          </tr>
        `;
        totalApurou += v.apurou || 0;
        totalDevolveu += v.devolveu || 0;
        totalRecebeu += v.recebeu || 0;
        totalDeve += v.deve || 0;
      }
    }

    // ðŸ”¹ Soma as despesas do mesmo documento
    for (const item in despesas) {
      const valor = despesas[item];
      if (typeof valor === "number") totalDespesas += valor;
    }

    // ðŸ”¹ Atualiza totais
    document.getElementById("totalApurou").textContent = totalApurou.toFixed(2);
    document.getElementById("totalDevolveu").textContent = totalDevolveu.toFixed(2);
    document.getElementById("totalRecebeu").textContent = totalRecebeu.toFixed(2);
    document.getElementById("totalDeve").textContent = totalDeve.toFixed(2);
    document.getElementById("totalDespesas").textContent = totalDespesas.toFixed(2);
    document.getElementById("saldoFinal").textContent = (totalApurou - totalDespesas).toFixed(2);
  }

  carregarCaixa();
</script>
</body>
</html>
