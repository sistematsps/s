<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Master - Resumo Diário</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
      margin: 0;
    }
    h1, h2 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #007bff;
      color: white;
    }
    tfoot td {
      font-weight: bold;
      background: #f0f0f0;
    }
    .container {
      max-width: 1000px;
      margin: auto;
    }
    .totais {
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Resumo Diário - Painel do Master</h1>
    <h2 id="dataTitulo"></h2>

    <h3>Vendas</h3>
    <table id="tabelaVendas">
      <thead>
        <tr>
          <th>Vendedor</th>
          <th>Cotação</th>
          <th>Vendeu</th>
          <th>Apurou</th>
          <th>Devolveu</th>
          <th>Recebeu</th>
          <th>Pagou</th>
          <th>Deve</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="3">Totais</td>
          <td id="totalApurou">0.00</td>
          <td id="totalDevolveu">0.00</td>
          <td id="totalRecebeu">0.00</td>
          <td id="totalPagou">0.00</td>
          <td id="totalDeve">0.00</td>
        </tr>
      </tfoot>
    </table>

    <h3>Despesas</h3>
    <table id="tabelaDespesas">
      <thead>
        <tr>
          <th>Descrição</th>
          <th>Valor (R$)</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td><b>Total de Despesas</b></td>
          <td id="totalDespesas">0.00</td>
        </tr>
      </tfoot>
    </table>

    <div class="totais">
      <h3>Resumo Final</h3>
      <p><b>Total Vendas (Apurou):</b> R$ <span id="resumoVendas">0.00</span></p>
      <p><b>Total Despesas:</b> R$ <span id="resumoDespesas">0.00</span></p>
      <p><b>Saldo Final:</b> R$ <span id="saldoFinal">0.00</span></p>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // Configuração Firebase
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_AUTH_DOMAIN",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_STORAGE_BUCKET",
      messagingSenderId: "SEU_SENDER_ID",
      appId: "SEU_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Função principal
    async function carregarDados() {
      const hoje = new Date();
      const dataAtual = hoje.toISOString().split('T')[0]; // formato YYYY-MM-DD
      document.getElementById("dataTitulo").textContent = `Data: ${dataAtual}`;

      const docRef = doc(db, "cotacoes", dataAtual);
      const docSnap = await getDoc(docRef);

      if (!docSnap.exists()) {
        alert("Nenhum dado encontrado para hoje!");
        return;
      }

      const dados = docSnap.data();
      const vendas = dados.vendas || {};
      const despesas = dados.despesas || {};

      const tbodyVendas = document.querySelector("#tabelaVendas tbody");
      tbodyVendas.innerHTML = "";

      let totalApurou = 0, totalDevolveu = 0, totalPagou = 0, totalRecebeu = 0, totalDeve = 0;

      for (const vendedor in vendas) {
        const registros = vendas[vendedor];
        for (const chave in registros) {
          const v = registros[chave];
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${vendedor}</td>
            <td>${v.cotacao?.toFixed(2) || "0.00"}</td>
            <td>${v.vendeu?.toFixed(2) || "0.00"}</td>
            <td>${v.apurou?.toFixed(2) || "0.00"}</td>
            <td>${v.devolveu?.toFixed(2) || "0.00"}</td>
            <td>${v.recebeu?.toFixed(2) || "0.00"}</td>
            <td>${v.pagou?.toFixed(2) || "0.00"}</td>
            <td>${v.deve?.toFixed(2) || "0.00"}</td>
          `;
          tbodyVendas.appendChild(row);

          totalApurou += v.apurou || 0;
          totalDevolveu += v.devolveu || 0;
          totalPagou += v.pagou || 0;
          totalRecebeu += v.recebeu || 0;
          totalDeve += v.deve || 0;
        }
      }

      document.getElementById("totalApurou").textContent = totalApurou.toFixed(2);
      document.getElementById("totalDevolveu").textContent = totalDevolveu.toFixed(2);
      document.getElementById("totalPagou").textContent = totalPagou.toFixed(2);
      document.getElementById("totalRecebeu").textContent = totalRecebeu.toFixed(2);
      document.getElementById("totalDeve").textContent = totalDeve.toFixed(2);

      // Exibir despesas
      const tbodyDespesas = document.querySelector("#tabelaDespesas tbody");
      tbodyDespesas.innerHTML = "";

      let totalDespesas = 0;
      for (const key in despesas) {
        if (key !== "total") {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${key}</td>
            <td>${Number(despesas[key]).toFixed(2)}</td>
          `;
          tbodyDespesas.appendChild(row);
          totalDespesas += Number(despesas[key]);
        }
      }

      document.getElementById("totalDespesas").textContent = totalDespesas.toFixed(2);

      // Resumo final
      document.getElementById("resumoVendas").textContent = totalApurou.toFixed(2);
      document.getElementById("resumoDespesas").textContent = totalDespesas.toFixed(2);
      document.getElementById("saldoFinal").textContent = (totalApurou - totalDespesas).toFixed(2);
    }

    carregarDados();
  </script>
</body>
</html>
